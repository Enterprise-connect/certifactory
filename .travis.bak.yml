#
#  Copyright (c) 2019 General Electric Company. All rights reserved.
#
#  The copyright to the computer software herein is the property of
#  General Electric Company. The software may be used and/or copied only
#  with the written permission of General Electric Company or in accordance
#  with the terms and conditions stipulated in the agreement/contract
#  under which the software has been supplied.
#
#  author: apolo.yasuda@ge.com
#

language: minimal
if: head_branch =~ ^beta_update$ OR branch = beta

env:
  global:
    - AGENT_REV="1.2-b.0.reiwa"
    - CA_CERT="LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUdQakNDQlNhZ0F3SUJBZ0lSQU01amZhdEEvRDkxZzR0UmlEZHY3Qmd3RFFZSktvWklodmNOQVFFTEJRQXcKZ2Q0eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJJd0VBWURWUVFIRXdsVApZVzRnVW1GdGIyNHhHakFZQmdOVkJBa1RFVEkyTWpNZ1EyRnRhVzV2SUZKaGJXOXVNUTR3REFZRFZRUVJFd1U1Ck5EVTRNekVxTUNnR0ExVUVDaE1oUlc1MFpYSndjbWx6WlMxRGIyNXVaV04wSUVONVltVnlMVk5sWTNWeWFYUjUKTVI4d0hRWURWUVFERXhaRlF5QkRRU0JUWlhKMmFXTmxjeUJKU1NCQ1pYUmhNUzB3S3dZRFZRUUZFeVF6WWpaagpabVV6WWkweE56TTFMVFJsTTJJdE9UbGlOUzFoTVRFeE5tRXlZekpsTnpZd0hoY05NakF3T0RBeU1UVXpOek00CldoY05Nakl3T0RBeU1UVXpOek00V2pDQ0FSWXhDekFKQmdOVkJBWVRBbFZUTVJFd0R3WURWUVFJRXdoTmFXTm8KYVdkaGJqRWpNQ0VHQTFVRUJ4TWFWbUZ1SUVKMWNtVnVJRU5vWVhKMFpYSWdWRzkzYm5Ob2FYQXhHekFaQmdOVgpCQWtURWpRd0lGZGxjM1FnUlNCTllXbHVJRk4wTGpFT01Bd0dBMVVFRVJNRk5EZ3hNVEV4R3pBWkJnTlZCQW9UCkVrVnVkR1Z5Y0hKcGMyVXRRMjl1Ym1WamRERXFNQ2dHQTFVRUN4TWhSVzUwWlhKd2NtbHpaUzFEYjI1dVpXTjAKSUV4cFkyVnVjMmx1WnlCRWFYWXVNU293S0FZRFZRUURFeUZGYm5SbGNuQnlhWE5sTFVOdmJtNWxZM1FnVEdsagpaVzV6YVc1bklFTkJJRWt4TFRBckJnTlZCQVVUSkRVeE5tVXhZMlkwTFdFNE9HTXRORFE1T0MxaVptRXlMVEZqCk5UZzROVFJoTURrMllUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQVBFN0t3cy8KZWZiQ3dub1JRalpVeEtBbHFwWEplck5jTU1sT1BkcEJ0ZlphMzFhWWxSZ2xMOFlsTWx0cnBsakdZOXZpaS9Vdgpna0syWGZiWmpvNW94TVdCVFUva1JYWERpMjhIUGtBZmhhZjh0YnpKaS9zQ0M2WW5QWkVidzVEQlFjSXNKK2pMClFpOFZIK0VpTE01OENYN0JucnVMc1h2OE5wMGNHdHBHTG1pbWZuS1RoRVREaUs1UWFTZ2lvbzR4N2NaZDVZc0kKa0dQdk9zd1VkWm9Mdjg3Q3owYi9oYTgzOWtac1ZHYXlRLzgxMy9tWXN2TEJadU5IMnVNT0ZMcnFETGlCNXo5RwoyMU5GM3VFcDFFWTBiR3k5aUF2VG1iVlJQTy9KWTZZbUQ5SURpY252YWJsZzhWdEE4M3Z5TkxVUjFQWklnSEgvCmVhc2JZdFZnbUtKR3ZpRUNBd0VBQWFPQ0Fib3dnZ0cyTUE0R0ExVWREd0VCL3dRRUF3SUNwREFkQmdOVkhTVUUKRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXRCZ05WSFE0RQpKZ1FrTlRFMlpURmpaalF0WVRnNFl5MDBORGs0TFdKbVlUSXRNV00xT0RnMU5HRXdPVFpoTUM4R0ExVWRJd1FvCk1DYUFKR1kwTmpsa01UVmhMV00zWkRNdE5HRTVaUzA1TVRNeExXRTFOVGRoTm1ReE9UYzBNekNCa1FZRFZSMFIKQklHSk1JR0dnaHhsYm5SbGNuQnlhWE5sTFdOdmJtNWxZM1F1WjJsMGFIVmlMbWx2Z1JKbFl5MXlaWE5sWVhKagphRUJuWlM1amIyMkhCSDhBQUFHSEVBQUFBQUFBQUFBQUFBQUFBQUFBQUFHSEJNQ29WUmFIQk1Db1Z0K0hFUDZBCkFBQUFBQUFBM3FZeS8vNG1rYnVIQkdWbEVQNkhFUDZBQUFBQUFBQUFBRUxULy82aVhTNkhCS3dSQUFFd0RBWUQKTWdvQkJBVkJSRTFKVGpBTkJnTThDZ0VFQmtWRFgwVkRUekFPQmdOR0NnRUVCMU5sWVhSZmVERXdEd1lEUEJRQgpCQWhoY0hBdVlYVjBhREFWQmdNOEhnRUVEbWRoZEdWM1lYa3NjMlZ5ZG1WeU1Dc0dBMFlVQVFRa01ERTJPRFZqCllUUXRPV0UzWmkwME1EQXpMV0V6WmpRdFpUVmhZVGMyWmpaak1URmpNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUIKQVFDTkt6TnBXTEdOZktqUnZ5eGlZMFZwWlhTSk90d1Vkd3VWb2RqMGYyV0FTMnkrZDlxbFhnSWtJcjRDWmY0SApMWGJkOVVCdnJNWWNCTGJrb3hZTThlK25MSnFOV1NLUUhZdjVFZkdOSS9zM1BnczUvK1Vuczl2bjIwaUdIRFZ5CldJWXdyV2pVMldZdWw1Um5aMlpNdzJtUjhuWE1XeFprY1ZXb3ZIekFhZm1FWVJzWkg1Q0NidU8vTXcrM1RCSVoKRGFPa0VBS3BTZGh1bFRPaGl1NjFjYTB5YWtBOFlha2J5Vk9UZFhEN3RkSG80VWova0VtL0x3MVBUQjJwai82TApjVXlFQlFscHNQZkNXSGVUM0E5WERQU3BSS21HdC9nVU9SNlIzU25hZXBhWTlYSVZoczE3MGpZeE50dHV5RDFtCkxKVTRWelJqV0s0MDZDMjBUVlFheHJOcgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlGZ0RDQ0JHaWdBd0lCQWdJUVFIRXpSMHZOcUNBKzY5ZUE4bS9oS2pBTkJna3Foa2lHOXcwQkFRc0ZBRENCCjNqRUxNQWtHQTFVRUJoTUNWVk14RXpBUkJnTlZCQWdUQ2tOaGJHbG1iM0p1YVdFeEVqQVFCZ05WQkFjVENWTmgKYmlCU1lXMXZiakVhTUJnR0ExVUVDUk1STWpZeU15QkRZVzFwYm04Z1VtRnRiMjR4RGpBTUJnTlZCQkVUQlRrMApOVGd6TVNvd0tBWURWUVFLRXlGRmJuUmxjbkJ5YVhObExVTnZibTVsWTNRZ1EzbGlaWEl0VTJWamRYSnBkSGt4Ckh6QWRCZ05WQkFNVEZrVkRJRU5CSUZObGNuWnBZMlZ6SUVsSklFSmxkR0V4TFRBckJnTlZCQVVUSkROaU5tTm0KWlROaUxURTNNelV0TkdVellpMDVPV0kxTFdFeE1URTJZVEpqTW1VM05qQWdGdzB4T0RBM01qTXhOVEU1TWpkYQpHQTh5TWpFd01ETXhPVEUyTVRreU4xb3dnZDR4Q3pBSkJnTlZCQVlUQWxWVE1STXdFUVlEVlFRSUV3cERZV3hwClptOXlibWxoTVJJd0VBWURWUVFIRXdsVFlXNGdVbUZ0YjI0eEdqQVlCZ05WQkFrVEVUSTJNak1nUTJGdGFXNXYKSUZKaGJXOXVNUTR3REFZRFZRUVJFd1U1TkRVNE16RXFNQ2dHQTFVRUNoTWhSVzUwWlhKd2NtbHpaUzFEYjI1dQpaV04wSUVONVltVnlMVk5sWTNWeWFYUjVNUjh3SFFZRFZRUURFeFpGUXlCRFFTQlRaWEoyYVdObGN5QkpTU0JDClpYUmhNUzB3S3dZRFZRUUZFeVF6WWpaalptVXpZaTB4TnpNMUxUUmxNMkl0T1RsaU5TMWhNVEV4Tm1FeVl6SmwKTnpZd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM3M25MTy92QVFiM3NTcEplTQo0dC9WTmNHRzRyWkxQMDVmblZmWDhBdUlNaHp6Z2RHV0R0MkM4NHM0bTJGOFI2eW40L1U1Q09GRjJCSVF1T2hjCnJKSkpEbkJIeEpKQVVVajBQVFhvNmpmS3VDSERmTE8zYVNVOG43QTlzeDFoK3lJZXYrbmJPcjYzOGlmVWtBSm0KejgyeDhjazVrZ2lnZVU1VzMyV1V4VGdINzJZdVRVMy9PZFVuRi9zR2VDQnMwNHZVWDFKSlJrMjdFeENHR0xPeQpZbjRCc3VyZ0N2dXg1SUxMLzh3VS9acnhVR3VjdkpZYWxMQjJzaG05cW54c2lzV09RcVpIeTkzTkhxVmtRQVl6Ckpocko4RlZiRnlteWIwcEhoaGFMVWRHcUttYW5nSDhZK1R5YkczME5uZDdySE9aTStodjZJRFdjZWo1dTVvcFEKV0ZvM0FnTUJBQUdqZ2dFME1JSUJNREFPQmdOVkhROEJBZjhFQkFNQ0FxUXdIUVlEVlIwbEJCWXdGQVlJS3dZQgpCUVVIQXdFR0NDc0dBUVVGQndNQ01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0xRWURWUjBPQkNZRUpHWTBOamxrCk1UVmhMV00zWkRNdE5HRTVaUzA1TVRNeExXRTFOVGRoTm1ReE9UYzBNekF2QmdOVkhTTUVLREFtZ0NSbU5EWTUKWkRFMVlTMWpOMlF6TFRSaE9XVXRPVEV6TVMxaE5UVTNZVFprTVRrM05ETXdnWTBHQTFVZEVRU0JoVENCZ29JSgpaV011WjJVdVkyOXRnUTlsWXk1eWIySnZkRUJuWlM1amIyMkhCSDhBQUFHSEVBQUFBQUFBQUFBQUFBQUFBQUFBCkFBR0hFUDZBQUFBQUFBQUFBQUFBQUFBQUFBR0hFUDZBQUFBQUFBQUFBTU5Cc01XYjM0aUhCTUNvVnhpSEVQNkEKQUFBQUFBQUFMRmVELy82UEN4T0hFUDZBQUFBQUFBQUE0SHdqaTI1NnRtSXdEUVlKS29aSWh2Y05BUUVMQlFBRApnZ0VCQUlYcXBUVjIxVkQ0dm9sMEJvQ1FDaVRsdmZaTm1mQVdYM1ozUEZzeWdabHRLMG5DdElLY0U0THV0WkRDClZjWEkvQWo4ZEJFbFl2M2wwcjlQNU42N1c5MWgxL2FMbStEa2ZDZWpwVkRKVndCRTVmdkR4T2ZZTlZHOVlFanEKVkJyRHdicnVFVUlCTDFFUGh6a3hQZEJ2VTVsdXBieDNlY2pKRzIzTTlwcXFNa1JpZUg4bVdpS3FrMTh5cEtFSwpoYVNhbGtGZFJIdTdEdmZ1cVVvK1k5UmkrcjhaUmF2TjkzV1hHNldKdENQQm1NTUJGZ2NhSGlwNWFHOUpLQUJzCklzNVJlR1UyMGRKVno0TDBtNFpuOHhvVnRYU1BWa0tXeHhzS0VCb2JrbUNZdzR5ZnV6aXRnOUNFSndlbjNMR0gKdjZadEZ5ZFdsTWVsY0w5SnJJTG9xU1Z3QnFvPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t"

before_install:

script: chmod 775 script.sh && source ./script.sh

before_deploy: chmod 775 ./before_deploy.sh && source ./before_deploy.sh

deploy:
  provider: script
  script: chmod 775 deploy.sh && ./deploy.sh
  skip_cleanup: true
  on:
    branch: beta
    
#deploy:
#  provider: pages 
#  github_token: $GITHUB_TOKEN
#  local_dir: .
#  target_branch: disty
#  verbose: true
#  skip_cleanup: true
#  keep_history: true
#  on:
#    branch: beta

#after_deploy: chmod 775 ./after_deploy.sh && ./after_deploy.sh

notifications:
  slack:
    rooms:
      secure: FJmyYJDJS4SIlp9E/Af/ZcmUYOYq3OYPKYcSkzTXLnOaHlfWKgRVLGqq4NfV7UoMi1AiQj3NdBKNGVUfmVXQdBiSXcK/1iZxY+Iy8RT4RhZD+ZP/L8RYj+v/JN0wihiF3KGDLO3GBh2M4yUhqFaNABRCuDMDcgebNC11DX5jLW/wL6bKF77UQp9F8FgRAmXkXWzFCBZdjOT0l8B05aweLd0pWotNgCjC52kHZmKGbsO/3Mh+Ow5KGaELH1X5JDeWQnn+2KChGyHfOM/ZB1gR2scSYtUKzsAf5VNFTYwYpaQIW/jUydLRDeQC59vczkIjuD07zlCPutxIWVEM9bb1dU1Wmq448JdTcsPdeeDNV6ihDf+D5yHDraHMHy0E/7fkyOBOnfbZSDPbYAzH39UE1sZflT6wMRc7f4SqOeIMNsWcTqTJ1L8CtPbBbEITIZpOQyOaDKZQspOn53c7HIuhLHn7uO9JI7kUmPVf+pHfUubs1AF6EgmR+GQausouC/alJJ0n3Cg6Pra8wdxx1orBhzXlQM4tHb7UUpmAqXUqyBhsHLcGkIA2BpyjpjPnAPEaZiaYCr1k5vZzA/Fu2lTt5Wep1CiDpa6BTUJ7773b+qsaJfQNGMJ/0nuqMY8fSDng6Q7VgDSUm8GG2eRSDY5OgEH23ROXNXSt1AFr19nnIpE=
    template:
      - "The Certificate-Request Build (Beta) <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} by %{author} %{result} in %{duration}. Please review the CSR content, sign and issue the cert if valid."
  email:
    recipients:  
      - ec-research@ge.com
    on_success: always  
    on_failure: always
